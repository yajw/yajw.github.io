<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>blog -  Gitment定制</title><link rel="icon" href="/favicon.ico"/><link rel="stylesheet" href="/static/css/androidstudio.min.css"/><script src="/static/js/highlight.min.js"></script><script>hljs.highlightAll();</script><meta name="next-head-count" content="7"/><link rel="preload" href="/_next/static/css/3c5946e20da2cc20d075.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3c5946e20da2cc20d075.css" data-n-g=""/><link rel="preload" href="/_next/static/css/e2e6dc732d39303ab748.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e2e6dc732d39303ab748.css" data-n-p=""/><link rel="preload" href="/_next/static/css/4b5ef9ffeb729d4f1c31.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4b5ef9ffeb729d4f1c31.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-c006ee6087559bbd65e3.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.15878d4e523f86636251.js" as="script"/><link rel="preload" href="/_next/static/chunks/99f422a92ff7083adb8a7d840734144fa7589f68.e37cca09058b1656d546.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-86af5e0fcdd51c9c3a66.js" as="script"/><link rel="preload" href="/_next/static/chunks/314642ff.81d3755a1df95fed9f2f.js" as="script"/><link rel="preload" href="/_next/static/chunks/762e22088df2ca7ea97d3f731b2a7315c482f91e.cb9acb13aef2b3683e00.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5Blink%5D-87cd50cf458654f0c030.js" as="script"/></head><body><div id="__next"><div class="Home_container__1EcsU"><main class="Home_main__1x8gC"><div class="ui text container"><h1 class="ui header"> Gitment定制</h1><span></span><section><h2>评论倒序</h2>
<p>github issue获取comments的api不支持倒序，替换下原有获取comments的逻辑即可。
具体是这个函数：<code>Gitment.loadComments</code>，改写代码如下：</p>
<pre><code class="language-js">{
    key: 'loadComments',
    value: function loadComments() {
      var _this8 = this;

      var page = arguments.length > 0 &#x26;&#x26; arguments[0] !== undefined ? arguments[0] : this.state.currentPage;
      var reverse = true
      return this.getIssue().then(function (issue) {
        if (!reverse) {
            return _utils.http.get(issue.comments_url, { page: page, per_page: _this8.perPage }, '');
        } else {
            var pageSize = Math.min(Math.max(_this8.perPage, 0), 50)

            var total = issue.comments
            var totalPageCount = Math.floor((total + pageSize - 1) / pageSize)
            console.log(total, totalPageCount)

            var pageNo = Math.min(Math.max(page, 0), totalPageCount)

            var start = (pageNo - 1) * pageSize + 1
            var end = Math.min(pageNo * pageSize, total)
            
            var inverseStart = total + 1 - end
            var inverseEnd = total + 1 - start
            console.log(inverseStart, inverseEnd)

            var inverseStartPageNo = Math.floor((inverseStart - 1) / pageSize + 1)
            console.log(inverseStartPageNo)
            
            var comments_url = issue.comments_url
            return _utils.http.get(comments_url, {
                    page: inverseStartPageNo, 
                    per_page: pageSize 
                }, ''
            ).then(function(startPageComments) {
                var comments = []
                var preCount = (inverseStartPageNo - 1) * pageSize
                var to =  Math.min(startPageComments.length, inverseEnd-preCount)
                for (var i = inverseStart-1-preCount; i &#x3C; to; i++) {
                    comments.push(startPageComments[i])
                }
                if (startPageComments.length &#x3C; inverseEnd-preCount) {
                    return _utils.http.get(comments_url, { 
                            page: inverseStartPageNo+1, 
                            per_page: pageSize 
                        }, ''
                    ).then(function(nextPageComments) {
                        var preCount = inverseStartPageNo * pageSize
                        for (var i = 0; i &#x3C; inverseEnd-preCount; i++) {
                            comments.push(nextPageComments[i])
                        }
                        return comments
                    });
                } else {
                    return comments
                }
            }).then(function(comments) {
                return comments.reverse()
            });
        }
      }).then(function (comments) {
        _this8.state.comments = comments;
        return comments;
      });
    }
  },
</code></pre>
</section><div role="list" class="ui list"><div role="listitem" class="item">2021-03-27 14:49:15 +0800<!-- --> <!-- -->yajw<!-- --> <!-- -->Copy old posts<!-- --> <!-- -->A</div></div><div id="comments"></div></div></main><footer class="Home_footer__1WdhD"><div class="Home_powered__2GdUA">Powered by<!-- --> <a href="https://nextjs.org/" target="_blank" rel="noopener noreferrer">Next.js</a>.</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":" Gitment定制","date":"2019-09-11T22:35:39.000Z","tags":["gitment","hexo"],"comments":true,"categories":["hexo"],"modifyTime":"2021-03-27 14:49:15 +0800","createTime":"2021-03-27 14:49:15 +0800","logs":[{"status":["A"],"files":["\"2021-03-27 Gitment\\345\\256\\232\\345\\210\\266.md\""],"abbrevHash":"f4f4061","hash":"f4f406175bde5279c552d8bac1c05cf7bb72d58e","subject":"Copy old posts","authorName":"yajw","authorDate":"2021-03-27 14:49:15 +0800"}],"link":"2021-03-27%20Gitment%E5%AE%9A%E5%88%B6","id":"9f7178e7-1641-4118-b39a-c1b970f4797e","content":"\u003ch2\u003e评论倒序\u003c/h2\u003e\n\u003cp\u003egithub issue获取comments的api不支持倒序，替换下原有获取comments的逻辑即可。\n具体是这个函数：\u003ccode\u003eGitment.loadComments\u003c/code\u003e，改写代码如下：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-js\"\u003e{\n    key: 'loadComments',\n    value: function loadComments() {\n      var _this8 = this;\n\n      var page = arguments.length \u003e 0 \u0026#x26;\u0026#x26; arguments[0] !== undefined ? arguments[0] : this.state.currentPage;\n      var reverse = true\n      return this.getIssue().then(function (issue) {\n        if (!reverse) {\n            return _utils.http.get(issue.comments_url, { page: page, per_page: _this8.perPage }, '');\n        } else {\n            var pageSize = Math.min(Math.max(_this8.perPage, 0), 50)\n\n            var total = issue.comments\n            var totalPageCount = Math.floor((total + pageSize - 1) / pageSize)\n            console.log(total, totalPageCount)\n\n            var pageNo = Math.min(Math.max(page, 0), totalPageCount)\n\n            var start = (pageNo - 1) * pageSize + 1\n            var end = Math.min(pageNo * pageSize, total)\n            \n            var inverseStart = total + 1 - end\n            var inverseEnd = total + 1 - start\n            console.log(inverseStart, inverseEnd)\n\n            var inverseStartPageNo = Math.floor((inverseStart - 1) / pageSize + 1)\n            console.log(inverseStartPageNo)\n            \n            var comments_url = issue.comments_url\n            return _utils.http.get(comments_url, {\n                    page: inverseStartPageNo, \n                    per_page: pageSize \n                }, ''\n            ).then(function(startPageComments) {\n                var comments = []\n                var preCount = (inverseStartPageNo - 1) * pageSize\n                var to =  Math.min(startPageComments.length, inverseEnd-preCount)\n                for (var i = inverseStart-1-preCount; i \u0026#x3C; to; i++) {\n                    comments.push(startPageComments[i])\n                }\n                if (startPageComments.length \u0026#x3C; inverseEnd-preCount) {\n                    return _utils.http.get(comments_url, { \n                            page: inverseStartPageNo+1, \n                            per_page: pageSize \n                        }, ''\n                    ).then(function(nextPageComments) {\n                        var preCount = inverseStartPageNo * pageSize\n                        for (var i = 0; i \u0026#x3C; inverseEnd-preCount; i++) {\n                            comments.push(nextPageComments[i])\n                        }\n                        return comments\n                    });\n                } else {\n                    return comments\n                }\n            }).then(function(comments) {\n                return comments.reverse()\n            });\n        }\n      }).then(function (comments) {\n        _this8.state.comments = comments;\n        return comments;\n      });\n    }\n  },\n\u003c/code\u003e\u003c/pre\u003e\n"}},"__N_SSG":true},"page":"/blog/[link]","query":{"link":"2021-03-27 Gitment定制"},"buildId":"ravzvVxRlFE3_IAU4jdd7","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-ff94e68042added27a93.js"></script><script src="/_next/static/chunks/main-c006ee6087559bbd65e3.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.15878d4e523f86636251.js" async=""></script><script src="/_next/static/chunks/99f422a92ff7083adb8a7d840734144fa7589f68.e37cca09058b1656d546.js" async=""></script><script src="/_next/static/chunks/pages/_app-86af5e0fcdd51c9c3a66.js" async=""></script><script src="/_next/static/chunks/314642ff.81d3755a1df95fed9f2f.js" async=""></script><script src="/_next/static/chunks/762e22088df2ca7ea97d3f731b2a7315c482f91e.cb9acb13aef2b3683e00.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5Blink%5D-87cd50cf458654f0c030.js" async=""></script><script src="/_next/static/ravzvVxRlFE3_IAU4jdd7/_buildManifest.js" async=""></script><script src="/_next/static/ravzvVxRlFE3_IAU4jdd7/_ssgManifest.js" async=""></script></body></html>