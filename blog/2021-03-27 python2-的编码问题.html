<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><title>blog -  python2-的编码问题</title><link rel="icon" href="/favicon.ico"/><link rel="stylesheet" href="/static/css/androidstudio.min.css"/><script src="/static/js/highlight.min.js"></script><script>hljs.highlightAll();</script><meta name="next-head-count" content="7"/><link rel="preload" href="/_next/static/css/3c5946e20da2cc20d075.css" as="style"/><link rel="stylesheet" href="/_next/static/css/3c5946e20da2cc20d075.css" data-n-g=""/><link rel="preload" href="/_next/static/css/e2e6dc732d39303ab748.css" as="style"/><link rel="stylesheet" href="/_next/static/css/e2e6dc732d39303ab748.css" data-n-p=""/><link rel="preload" href="/_next/static/css/4b5ef9ffeb729d4f1c31.css" as="style"/><link rel="stylesheet" href="/_next/static/css/4b5ef9ffeb729d4f1c31.css" data-n-p=""/><noscript data-n-css=""></noscript><link rel="preload" href="/_next/static/chunks/main-c006ee6087559bbd65e3.js" as="script"/><link rel="preload" href="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" as="script"/><link rel="preload" href="/_next/static/chunks/framework.15878d4e523f86636251.js" as="script"/><link rel="preload" href="/_next/static/chunks/99f422a92ff7083adb8a7d840734144fa7589f68.e37cca09058b1656d546.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/_app-86af5e0fcdd51c9c3a66.js" as="script"/><link rel="preload" href="/_next/static/chunks/314642ff.81d3755a1df95fed9f2f.js" as="script"/><link rel="preload" href="/_next/static/chunks/762e22088df2ca7ea97d3f731b2a7315c482f91e.cb9acb13aef2b3683e00.js" as="script"/><link rel="preload" href="/_next/static/chunks/pages/blog/%5Blink%5D-87cd50cf458654f0c030.js" as="script"/></head><body><div id="__next"><div class="Home_container__1EcsU"><main class="Home_main__1x8gC"><div class="ui text container"><h1 class="ui header"> python2-的编码问题</h1><span></span><section><h2>背景</h2>
<p>这篇blog是和python2中让人抓狂的编码异常做个了断。</p>
<p>仔细读了以下文档：</p>
<ul>
<li>python2 <a href="https://docs.python.org/2/howto/unicode.html">Unicode HOWTO</a></li>
<li>python3 <a href="https://docs.python.org/3/howto/unicode.html">Unicode HOWTO</a></li>
</ul>
<h2>编码异常以及Python 2 的str和unicode</h2>
<p>character：表示文本的最小的不可分割字符，例如"A", "饕"，"È"等。</p>
<p>code point：是一个整数（注意仅仅是数值，并没有限制存储上需要几个字节），通常用16进制表示，和character能够对应起来。</p>
<p>unicode标准：定义了character和code point之间的mapping。</p>
<p>屏幕上的字符：是专门的图形表示元素glyph通过程序渲染的效果。</p>
<p>换言之，屏幕上看到的字符的表示（character），对应一个code point（整数），并且对应一个特定的字符（抽象意义）。</p>
<p>encoding： 把unicode字符串转化为字节数组，注意这里并不确定具体按照什么规则转化、怎么转化，是固定用4个字节，还是用8个字节，或者用变长，encoding没有明确这个规则。</p>
<p>编码（以utf-8为例）：定义了encoding的规则，也就是unicode字符串和字节数组之间如何相互转化，utf-8是一种变长的规则。</p>
<p>ascii编码：只支持0-127，如果一个code point的值超过127，encoding时就会报UnicodeEncodeError。</p>
<pre><code class="language-python">>>> u'羁绊是什么意思'.encode('ascii')
Traceback (most recent call last):
  File "&#x3C;stdin>", line 1, in &#x3C;module>
UnicodeEncodeError: 'ascii' codec can't encode characters in position 0-6: ordinal not in range(128)
>>>
</code></pre>
<p>UTF-8的特点：变长，支持所有unicode code point，没有0字节，比较鲁棒（能够识别出一个字节是否是code point的开始）。</p>
<p>上面的例子用utf-8编码：</p>
<pre><code class="language-python">>>> u'羁绊是什么意思'.encode('utf-8')
'\xe7\xbe\x81\xe7\xbb\x8a\xe6\x98\xaf\xe4\xbb\x80\xe4\xb9\x88\xe6\x84\x8f\xe6\x80\x9d'
>>>
</code></pre>
<pre><code class="language-python">>>> unicode('abcdef' + chr(255))    
Traceback (most recent call last):
...
UnicodeDecodeError: 'ascii' codec can't decode byte 0xff in position 6:
ordinal not in range(128)
>>> unicode('\x80abc', errors='replace')
u'\ufffdabc'
>>> unicode('\x80abc', errors='ignore')
u'abc'
</code></pre>
<h2>后记</h2>
<p>基本上看完官方文档，就能清楚python2中unicode和str的区别，以及处理常见的编码问题了，所以到这就戛然而止了。</p>
</section><div role="list" class="ui list"><div role="listitem" class="item">2021-03-27 14:49:15 +0800<!-- --> <!-- -->yajw<!-- --> <!-- -->Copy old posts<!-- --> <!-- -->A</div></div><div id="comments"></div></div></main><footer class="Home_footer__1WdhD"><div class="Home_powered__2GdUA">Powered by<!-- --> <a href="https://nextjs.org/" target="_blank" rel="noopener noreferrer">Next.js</a>.</div></footer></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"post":{"title":" python2-的编码问题","comments":true,"date":"2020-04-07T12:19:39.000Z","tags":["python2","unicode","编码"],"modifyTime":"2021-03-27 14:49:15 +0800","createTime":"2021-03-27 14:49:15 +0800","logs":[{"status":["A"],"files":["\"2021-03-27 python2-\\347\\232\\204\\347\\274\\226\\347\\240\\201\\351\\227\\256\\351\\242\\230.md\""],"abbrevHash":"f4f4061","hash":"f4f406175bde5279c552d8bac1c05cf7bb72d58e","subject":"Copy old posts","authorName":"yajw","authorDate":"2021-03-27 14:49:15 +0800"}],"link":"2021-03-27%20python2-%E7%9A%84%E7%BC%96%E7%A0%81%E9%97%AE%E9%A2%98","id":"b5332086-81f5-4a07-a4b1-7dae911cfd37","categories":[],"content":"\u003ch2\u003e背景\u003c/h2\u003e\n\u003cp\u003e这篇blog是和python2中让人抓狂的编码异常做个了断。\u003c/p\u003e\n\u003cp\u003e仔细读了以下文档：\u003c/p\u003e\n\u003cul\u003e\n\u003cli\u003epython2 \u003ca href=\"https://docs.python.org/2/howto/unicode.html\"\u003eUnicode HOWTO\u003c/a\u003e\u003c/li\u003e\n\u003cli\u003epython3 \u003ca href=\"https://docs.python.org/3/howto/unicode.html\"\u003eUnicode HOWTO\u003c/a\u003e\u003c/li\u003e\n\u003c/ul\u003e\n\u003ch2\u003e编码异常以及Python 2 的str和unicode\u003c/h2\u003e\n\u003cp\u003echaracter：表示文本的最小的不可分割字符，例如\"A\", \"饕\"，\"È\"等。\u003c/p\u003e\n\u003cp\u003ecode point：是一个整数（注意仅仅是数值，并没有限制存储上需要几个字节），通常用16进制表示，和character能够对应起来。\u003c/p\u003e\n\u003cp\u003eunicode标准：定义了character和code point之间的mapping。\u003c/p\u003e\n\u003cp\u003e屏幕上的字符：是专门的图形表示元素glyph通过程序渲染的效果。\u003c/p\u003e\n\u003cp\u003e换言之，屏幕上看到的字符的表示（character），对应一个code point（整数），并且对应一个特定的字符（抽象意义）。\u003c/p\u003e\n\u003cp\u003eencoding： 把unicode字符串转化为字节数组，注意这里并不确定具体按照什么规则转化、怎么转化，是固定用4个字节，还是用8个字节，或者用变长，encoding没有明确这个规则。\u003c/p\u003e\n\u003cp\u003e编码（以utf-8为例）：定义了encoding的规则，也就是unicode字符串和字节数组之间如何相互转化，utf-8是一种变长的规则。\u003c/p\u003e\n\u003cp\u003eascii编码：只支持0-127，如果一个code point的值超过127，encoding时就会报UnicodeEncodeError。\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e\u003e\u003e\u003e u'羁绊是什么意思'.encode('ascii')\nTraceback (most recent call last):\n  File \"\u0026#x3C;stdin\u003e\", line 1, in \u0026#x3C;module\u003e\nUnicodeEncodeError: 'ascii' codec can't encode characters in position 0-6: ordinal not in range(128)\n\u003e\u003e\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003eUTF-8的特点：变长，支持所有unicode code point，没有0字节，比较鲁棒（能够识别出一个字节是否是code point的开始）。\u003c/p\u003e\n\u003cp\u003e上面的例子用utf-8编码：\u003c/p\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e\u003e\u003e\u003e u'羁绊是什么意思'.encode('utf-8')\n'\\xe7\\xbe\\x81\\xe7\\xbb\\x8a\\xe6\\x98\\xaf\\xe4\\xbb\\x80\\xe4\\xb9\\x88\\xe6\\x84\\x8f\\xe6\\x80\\x9d'\n\u003e\u003e\u003e\n\u003c/code\u003e\u003c/pre\u003e\n\u003cpre\u003e\u003ccode class=\"language-python\"\u003e\u003e\u003e\u003e unicode('abcdef' + chr(255))    \nTraceback (most recent call last):\n...\nUnicodeDecodeError: 'ascii' codec can't decode byte 0xff in position 6:\nordinal not in range(128)\n\u003e\u003e\u003e unicode('\\x80abc', errors='replace')\nu'\\ufffdabc'\n\u003e\u003e\u003e unicode('\\x80abc', errors='ignore')\nu'abc'\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2\u003e后记\u003c/h2\u003e\n\u003cp\u003e基本上看完官方文档，就能清楚python2中unicode和str的区别，以及处理常见的编码问题了，所以到这就戛然而止了。\u003c/p\u003e\n"}},"__N_SSG":true},"page":"/blog/[link]","query":{"link":"2021-03-27 python2-的编码问题"},"buildId":"ravzvVxRlFE3_IAU4jdd7","nextExport":false,"isFallback":false,"gsp":true}</script><script nomodule="" src="/_next/static/chunks/polyfills-ff94e68042added27a93.js"></script><script src="/_next/static/chunks/main-c006ee6087559bbd65e3.js" async=""></script><script src="/_next/static/chunks/webpack-50bee04d1dc61f8adf5b.js" async=""></script><script src="/_next/static/chunks/framework.15878d4e523f86636251.js" async=""></script><script src="/_next/static/chunks/99f422a92ff7083adb8a7d840734144fa7589f68.e37cca09058b1656d546.js" async=""></script><script src="/_next/static/chunks/pages/_app-86af5e0fcdd51c9c3a66.js" async=""></script><script src="/_next/static/chunks/314642ff.81d3755a1df95fed9f2f.js" async=""></script><script src="/_next/static/chunks/762e22088df2ca7ea97d3f731b2a7315c482f91e.cb9acb13aef2b3683e00.js" async=""></script><script src="/_next/static/chunks/pages/blog/%5Blink%5D-87cd50cf458654f0c030.js" async=""></script><script src="/_next/static/ravzvVxRlFE3_IAU4jdd7/_buildManifest.js" async=""></script><script src="/_next/static/ravzvVxRlFE3_IAU4jdd7/_ssgManifest.js" async=""></script></body></html>